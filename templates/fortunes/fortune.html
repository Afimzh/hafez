{% extends "base.html" %}
{% load static %}
{% block title %}ÙØ§Ù„ Ø­Ø§ÙØ¸{% endblock %}
{% block content %}
<div class="c-card">
    <h2 class="c-card__title">ğŸ”® ÙØ§Ù„ Ø­Ø§ÙØ¸</h2>
    <div class="c-card__body">

        <!-- Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹ ÙØ§Ù„ -->
        <div class="u-mt-3">
            <button id="new-fortune" class="btn">âœ¨ Ù„Ø·ÙØ§Ù‹ Ù†ÛŒØª Ú©Ù†ÛŒØ¯ Ùˆ Ø¯Ú©Ù…Ù‡ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯</button>
        </div>

        <!-- Ù†ØªÛŒØ¬Ù‡ ÙØ§Ù„ Ø§ÛŒÙ†Ø¬Ø§ Ø¸Ø§Ù‡Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
        <div id="fortune-result" class="u-mt-4"></div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const fortuneBtn = document.getElementById("new-fortune");
    const fortuneResult = document.getElementById("fortune-result");

    fortuneBtn.addEventListener("click", function () {
        fortuneBtn.textContent = "â³ Ø¯Ø± Ø­Ø§Ù„ Ú¯Ø±ÙØªÙ† ÙØ§Ù„...";
        fortuneBtn.disabled = true;

        fetch("{% url 'random_fortune' %}")
            .then(response => response.json())
            .then(data => {
                if (data.title) {
                    fortuneResult.innerHTML = `
                        <div class="quote">
                            <p>${data.title}</p>
                        </div>
                    `;
                } else if (data.error) {
                    fortuneResult.innerHTML = `
                        <div class="alert alert--error">
                            <p>${data.error}</p>
                        </div>
                    `;
                }
            })
            .catch(error => {
                fortuneResult.innerHTML = `
                    <div class="alert alert--error">
                        <p>Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ÙØ§Ù„ Ù¾ÛŒØ´ Ø¢Ù…Ø¯.</p>
                    </div>
                `;
                console.error(error);
            })
            .finally(() => {
                fortuneBtn.textContent = "âœ¨ ÙØ§Ù„ Ø¬Ø¯ÛŒØ¯ Ø¨Ú¯ÛŒØ±";
                fortuneBtn.disabled = false;
            });
    });
});
</script>
{% endblock %}
